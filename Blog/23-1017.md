# npm 常见问题

整理日常开发中遇到的 npm 相关常见问题及解决方案，涵盖安装、镜像源设置、依赖管理、常见第三方包 (如 Node Sass)、以及打包工具 Rollup，附带参考链接，便于查阅。

- [npm 常见问题](#npm-常见问题)
  - [安装 Install](#安装-install)
  - [镜像源 Registry](#镜像源-registry)
  - [依赖 Dependencies](#依赖-dependencies)
  - [Sass](#sass)
  - [Rollup](#rollup)

## 安装 Install

npm 包管理器的安装方式有多种，常见命令如下：

- `npm install` 或 `npm i`。
  安装依赖，会根据 `package.json` 和 `package-lock.json` 情况进行补充和升级。
- `npm ci`。
  严格按照 `package-lock.json` 安装依赖，适合持续集成环境，不会修改 `lock` 文件，速度更快且更可复现。

参考：[npm i 和 npm ci 区别](https://blog.mazey.net/1887.html)

## 镜像源 Registry

- 设置 npm / cnpm 镜像地址 (解决国内网络问题或加速安装)。

```bash
npm config set registry https://registry.npmjs.org/
npm config set registry https://registry.npmmirror.com/
```

- 为项目单独指定安装源，在根目录创建 `.npmrc` 文件，内容如：

```plain
registry=https://registry.npmmirror.com/
```

参考：

- [npm / cnpm 设置镜像地址](https://blog.mazey.net/2833.html)
- [Node.js 项目通过 .npmrc 文件指定依赖安装源](https://blog.mazey.net/2950.html)

## 依赖 Dependencies

- 直接安装 GitHub / GitLab 仓库代码。

```bash
npm install GIT_REMOTE_URL
```

- 本地调试可用 `npm link`。
  先在本地包目录执行 `npm link`，然后在目标项目执行 `npm link <PackageName>`。

参考：[npm 直接安装 GitHub/GitLab 仓库代码及npm link 本地调试](https://blog.mazey.net/2616.html)

## Sass

- Node Sass 安装超时或失败，常见解决方法：
  - 切换镜像源 (npmmirror)。
  - 增加网络超时时间。

```bash
npm install node-sass --registry=https://registry.npmmirror.com/ --fetch-timeout=60000
```

参考：[解决 npm 安装 Node Sass 因为网络问题超时失败的问题](https://blog.mazey.net/2291.html)

## Rollup

- 使用 Rollup 对 npm 包进行按需加载和高效打包。
  - 合理配置入口 (input) 和输出 (output)，支持多格式 (如 ESM、CJS)。
  - 利用 Rollup 插件 (如 `@rollup/plugin-node-resolve`, `@rollup/plugin-commonjs`) 提升兼容性和 Tree Shaking 效果。

参考：[使用 Rollup 打包可按需加载的 npm 包](https://blog.mazey.net/1526.html)

**版权声明**

本博客所有的原创文章，作者皆保留版权。转载必须包含本声明，保持本文完整，并以超链接形式注明作者[除除](https://github.com/chengchuu)和本文原始地址：<https://blog.mazey.net/5619.html>

(完)
